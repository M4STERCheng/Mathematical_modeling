# **问题**
&ensp;&ensp;企业内部的生产计划有各种不同的情况，从空间层次看，工厂要根据外部需求和内部设备、人力、原料等条件，以最大利润为目标制定产品的生产计划；车间则要根据产品生产计划、工艺流程、资源约束以及费用参数等，以最小成本为目标制定生产作业计划；从时间层次来看，若在短时间内认为外部需求和内部资源等不随时间变化，可制定单阶段生产计划，否则就要制定多阶段生产计划。  
&ensp;&ensp;一奶制品加工厂用牛奶生产$A_1、A_2$俩种奶制品，1桶牛奶可以在甲类设备上用12小时加工成3千克$A_1$,或者在乙类设备上用8个小时加工成4千克$A_2$。根据市场需求，生产的$A_1、A_2$全部能售出，且每千克$A_1$获利24元。每千克$A_2$获利16元。现在加工厂每天能得到50桶牛奶的供应，每天正式工人劳作时间为480小时，并且甲类设备每天至多能加工100千克$A_1$，乙类设备加工没有限制。该厂还开发了奶制品的深加工技术：用2小时和3元的加工费，可将1千克$A_1$加工成0.8千克高级奶制品$B_1$,也可将1千克$A_2$加工成0.75千克高级奶制品$B_2$，每千克$B_1$能获利44元，每千克$B_2$能获利32元.该厂指定一个生产销售计划，使每天的净利润最大，并讨论以下几个问题：

# **问题分析**
1、**决策变量**  

* $x_1$：在甲类设备上生产的$A_1$的千克数  
* $x_2$：在乙类设备上生产的$A_2$的千克数
* $x_3$：由$A_1$深加工成$B_1$的千克数,等于$0.8x_5$
* $x_4$：由$A_2$深加工成$B_2$的千克数,等于$0.75x_6$
* $x_5$: 被深加工成$B_1$的$A_1$千克数 
* $x_6$: 被深加工成$B_2$的$A_2$千克数

2、**目标函数**  
每天最大利润  
$$\max z = 24x_1 + 16x_2  + 44x_3 + 32X_4 - 3x_5 - 3x_6$$

3、**约束条件**  

* 牛奶供应约束：$ \frac{x_1+x_5}{3} + \frac{x_2+x_6}{4} \leq 50$
* 劳动时间约束：$ 4(x_1 + x_5) + 2(x_2+ x_6) + 2x_5 + 2x_6 \leq 480$
* 甲类设备生产约束: $x_1 + x_5 \leq 100$
* 非负性约束： $x_1, x_2, x_3, x_4, x_5, x_6 \geq 0$

# **求解代码**
```python
import pymprog as mp

# 定义线性规划模型
lp = mp.begin('Maximize_Profit')

# 定义决策变量
x1 = mp.var('x1')
x2 = mp.var('x2')
x3 = mp.var('x3')
x4 = mp.var('x4')
x5 = mp.var('x5')
x6 = mp.var('x6')

# 定义目标函数
maximize = 24 * x1 + 16 * x2 + 44 * x3 + 32 * x4 - 3 * x5 - 3 * x6

# 定义约束条件
mp.st((x1 + x5) / 3 + (x2 + x6) / 4 <= 50)
mp.st(4*(x1 + x5) + 2*(x2 + x6) + 2*x5 + 2*x6 <= 480)
mp.st(x1 + x5 <= 100)
mp.st(x3 == 0.8 * x5)
mp.st(x4 == 0.75 * x6)

# 最大化目标函数
mp.maximize(maximize)

# 求解问题
mp.solve()

# 输出结果
print("Status:", mp.status())
print("Optimal Solution:")
print("x1 =", x1.primal)
print("x2 =", x2.primal)
print("x3 =", x3.primal)
print("x4 =", x4.primal)
print("x5 =", x5.primal)
print("x6 =", x6.primal)
print("Maximum Profit =", mp.vobj())
```

    Status: 5
    Optimal Solution:
    x1 = 0.0
    x2 = 168.0
    x3 = 19.200000000000003
    x4 = 0.0
    x5 = 24.0
    x6 = 0.0
    Maximum Profit = 3460.8
    

其最优解为；  
* $x_1 = 0$
* $x_2 = 168.0kg$
* $x_3 = 19.2kg$
* $x_4 = 0kg$
* $x_5 = 24kg$
* $x_6 = 0kg$  
最优值为 $3460.8元$


```python
#  灵敏度分析
sensitivity()
```

    
    PyMathProg 1.0 Sensitivity Report Created: 2023/10/03 Tue 20:52PM
    ================================================================================
    Variable            Activity   Dual.Value     Obj.Coef   Range.From   Range.Till
    --------------------------------------------------------------------------------
     x1                        0        -1.68           24         -inf        25.68
    *x2                      168            0           16         13.9        24.15
    *x3                     19.2            0           44      40.8333        63.75
    *x4                        0            0           32 -1.79769e+308      34.0267
    *x5                       24            0           -3     -5.53333         12.8
     x6                        0        -1.52           -3         -inf        -1.48
    ================================================================================
    ================================================================================
    Constraint       Activity Dual.Value  Lower.Bnd  Upper.Bnd RangeLower RangeUpper
    --------------------------------------------------------------------------------
     R1                    50      37.92       -inf         50    26.6667         60
     R2                   480       3.26       -inf        480        400    733.333
    *R3                    24          0       -inf        100         24         24
     R4                     0         44          0          0      -19.2 1.79769e+308
     R5                     0         32          0          0          0 1.79769e+308
    ================================================================================
    

**报表说明**  
决策变量（Variables）部分：
* Activity（活动度）： 决策变量的最优取值
* Dual Value（对偶值）： 影子价格或拉格朗日乘子，表示目标函数系数的单位变化对最优解值的影响。
* Obj. Coef（目标函数系数）： 目标函数中各变量的系数。
* Range From（变化下限）： 目标函数系数可以减少到的最小值。
* 
Range Till（变化上限）： 目标函数系数可以增加到的最大
  
约束条件（Constraints）部分：
* Activity（活动度）： 约束条件的实际取值。
*
Dual Value（对偶值）： 影子价格或拉格朗日乘子，表示约束条件右侧常数的单位增加对最优解值的影响
* Lower Bound（下界）： 约束条件的下限。
* Upper Bound（上界）： 约束条件的上限。
* Range Lower（下限变化范围）： 约束条件右侧常数可以减少到的最小值。
* Range Upper（上限变化范围）： 约束条件右侧常数可以增加到的最大值。

#  **后续讨论**  

&ensp;&ensp;&ensp;&ensp;(1)若投资30元可以增加供应一桶牛奶，是否应该继续投资？若投资3元可以寄增加供应1小时的劳动时间，是否应该继续进行投资？若每天投资150元，可以赚回来多少？

&ensp;&ensp;由报表Dual Value（影子价格）中可以发现$R_1$的值为37.92，代表约束牛奶的影子价格为37.92元，表明增加一桶牛奶可使净利润增长37.92元。同理$R_2$的值为3.26说明每增加1小时的劳动时间可使净利润增长3.26元。由于$37.92 \gt 30、3.26 \gt 3$，可得到结果，应该继续投资。  
&ensp;&ensp;而多投资150元代表，可最多增加5桶奶或者工作50个小时。由于Range Upper（上限变化范围）可得到对于牛奶供应变量上限为10桶，劳动时间上限为733.333小时，增长量都在其中的范围内，易知都投资牛奶更加保证利润更高，此时可每天多赚$5 \times 7.92 = 39.6元$

&ensp;&ensp;&ensp;&ensp;(2)每千克高级奶制品$B_1、B_2$的获利经常有10%的波动,对制订的生产销售计划有无影响？

&ensp;&ensp;由Range From（变化下限）Range Till（变化上限）可以得到$x_3$的价值系数变化区间为  $[40.8,63.7]$,
$x_4$的价值系数变化区间为$(-\infty、34.0]$,若价格变动不超此范围，则不需要对制订的生产销售计划进行变化。$B_1$价格下降10%、上升10%后价格分别为：39.6、48.4；
$B_2$价格下降10%、上升10%后价格分别为：28.8、35.2。  
&ensp;&ensp;故$B_1$的价格下降后需要重新对制订的生产销售计划修改，上升不需要；$B_2$的价格下降后对制订的生产销售计划不需要修改，上升后需要修改。

&ensp;&ensp;&ensp;&ensp;(3)若公司已经签订了每天销售10千克$A_1$的合同且必须满足，该合同对公司的利润有什么影响？

&ensp;&ensp;需要在代码中添加$x_1 = 10$的约束变量即可。


```python
import pymprog as mp

# 定义线性规划模型
lp = mp.begin('Maximize_Profit')

# 定义决策变量
x1 = mp.var('x1')
x2 = mp.var('x2')
x3 = mp.var('x3')
x4 = mp.var('x4')
x5 = mp.var('x5')
x6 = mp.var('x6')

# 定义目标函数
maximize = 24 * x1 + 16 * x2 + 44 * x3 + 32 * x4 - 3 * x5 - 3 * x6

# 定义约束条件
mp.st((x1 + x5) / 3 + (x2 + x6) / 4 <= 50)
mp.st(4*(x1 + x5) + 2*(x2 + x6) + 2*x5 + 2*x6 <= 480)
mp.st(x1 + x5 <= 100)
mp.st(x3 == 0.8 * x5)
mp.st(x4 == 0.75 * x6)
mp.st(x1 == 10)

# 最大化目标函数
mp.maximize(maximize)

# 求解问题
mp.solve()

# 输出结果
print("Status:", mp.status())
print("Optimal Solution:")
print("x1 =", x1.primal)
print("x2 =", x2.primal)
print("x3 =", x3.primal)
print("x4 =", x4.primal)
print("x5 =", x5.primal)
print("x6 =", x6.primal)
print("Maximum Profit =", mp.vobj())
```

    Status: 5
    Optimal Solution:
    x1 = 10.0
    x2 = 160.0
    x3 = 16.0
    x4 = 0.0
    x5 = 20.0
    x6 = 0.0
    Maximum Profit = 3444.0
    

由运行杰克可以盈利结果从3460.8下降到3444元，减少了16.8元
